<!DOCTYPE html>
<html>

<head>
  <title><%= title %></title>
  <%- include("./common/stylesheets.ejs", {isAdmin: true}) %>
</head>

<body>
  <%- include("./common/header.ejs", {adminMenu: false, backMenu: false, backAdmin: false, backToMonth: true, id: userinfo.id}) %>
  <div class="container-top">
    <form method="POST" name="timelistform" action="/admin/<%= userinfo.id %>/<%= yyyymm %>">
      <div class="area-btn">
        <p id="updatebtn" class="monthtimebtn">更新</p>
        <p id="initbtn" class="monthtimebtn">元に戻す</p>
      </div>
      <div class="area">
        <% if (timelist) { %>
        <table>
          <tr>
            <th>日付</th>
            <th>出勤時間</th>
            <th>退勤時間</th>
            <th>出勤時間<br>(修正)</th>
            <th>退勤時間<br>(修正)</th>
            <th>賄</th>
            <th>朝<br>遅</th>
          </tr>
          <% timelist.forEach(function(timeinfo){ %>
          <tr>
            <td>
              <%= timeinfo.yyyymmddyoubi %>
              <input type="hidden" name="yyyymmdd" value="<%= timeinfo.yyyymmdd %>">
            </td>
            <td>
              <%= timeinfo.start %>
              <input type="hidden" name="start" value="<%= timeinfo.start %>">
            </td>
            <td>
              <%= timeinfo.end %>
              <input type="hidden" name="end" value="<%= timeinfo.end %>">
            </td>
            <td><input class="startupd" type="text" name="startupd" value="<%= timeinfo.startupd %>"></td>
            <td><input class="endupd" type="text" name="endupd" value="<%= timeinfo.endupd %>"></td>
            <%
              let makanaichecked;
              if (timeinfo.makanai === 'on') {
                makanaichecked = "checked";
              }
            %>
            <input type="hidden" name="makanai" value="off">
            <td><input class="makanai" type="checkbox" name="_makanai" value="on" <%= makanaichecked %>></td>
            <%
              let asaosochecked;
              if (timeinfo.asaoso === 'on') {
                asaosochecked = "checked";
              }
            %>
            <input type="hidden" name="asaoso" value="off">
            <td><input class="asaoso" type="checkbox" name="_asaoso" value="on" <%= asaosochecked %>></td>
          </tr>
          <% }) %>
        </table>
        <% } %>
      </div>
    </form>
  </div>
  <script>
    let updbtn = document.getElementById("updatebtn");
    updbtn.addEventListener('click', function () {
      for (let i = 0; i < document.timelistform.makanai.length; i++) {
        if (document.timelistform._makanai[i].checked) {
          document.timelistform.makanai[i].value = "on";
        }
      }
      for (let i = 0; i < document.timelistform.asaoso.length; i++) {
        if (document.timelistform._asaoso[i].checked) {
          document.timelistform.asaoso[i].value = "on";
        }
      }
      document.timelistform.submit();
    });
    let initbtn = document.getElementById("initbtn");
    initbtn.addEventListener('click', function () {
      document.location.reload();
    });
  </script>
</body>

</html>